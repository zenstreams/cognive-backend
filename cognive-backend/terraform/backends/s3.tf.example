# =============================================================================
# S3/MinIO Backend Configuration
# =============================================================================
# Use this backend for staging and production environments.
# State is stored in an S3-compatible bucket (AWS S3 or MinIO).
#
# Setup:
# 1. Create an S3 bucket (or MinIO bucket) for state storage
# 2. Create a DynamoDB table for state locking (AWS only)
# 3. Copy this file to your environment directory
# 4. Update the configuration values
# 5. Run: terraform init
# =============================================================================

# =============================================================================
# AWS S3 Backend (for AWS deployments)
# =============================================================================

# terraform {
#   backend "s3" {
#     # Bucket for state storage (create this first!)
#     bucket = "cognive-terraform-state"
#     
#     # Path within bucket (unique per environment)
#     key = "staging/terraform.tfstate"
#     
#     # AWS region
#     region = "us-east-1"
#     
#     # Enable encryption at rest
#     encrypt = true
#     
#     # DynamoDB table for state locking (prevents concurrent modifications)
#     dynamodb_table = "cognive-terraform-locks"
#     
#     # Optional: Use specific AWS profile
#     # profile = "cognive-infra"
#   }
# }

# =============================================================================
# MinIO Backend (for self-hosted deployments)
# =============================================================================

# terraform {
#   backend "s3" {
#     # MinIO bucket for state storage
#     bucket = "cognive-terraform-state"
#     
#     # Path within bucket
#     key = "staging/terraform.tfstate"
#     
#     # Required but not used by MinIO
#     region = "us-east-1"
#     
#     # MinIO endpoint (without https:// prefix)
#     endpoint = "minio.example.com:9000"
#     
#     # MinIO credentials (use environment variables instead!)
#     # access_key = "minioadmin"
#     # secret_key = "minioadmin"
#     
#     # MinIO-specific settings
#     skip_credentials_validation = true
#     skip_metadata_api_check     = true
#     skip_region_validation      = true
#     force_path_style            = true
#     
#     # Disable HTTPS if MinIO is not configured with TLS
#     # Use environment variable: AWS_S3_ENDPOINT=http://minio.example.com:9000
#   }
# }

# =============================================================================
# Setting Up State Backend
# =============================================================================
#
# For AWS S3:
# -----------
# 1. Create the S3 bucket:
#    aws s3 mb s3://cognive-terraform-state --region us-east-1
#
# 2. Enable versioning:
#    aws s3api put-bucket-versioning \
#      --bucket cognive-terraform-state \
#      --versioning-configuration Status=Enabled
#
# 3. Create DynamoDB table for locking:
#    aws dynamodb create-table \
#      --table-name cognive-terraform-locks \
#      --attribute-definitions AttributeName=LockID,AttributeType=S \
#      --key-schema AttributeName=LockID,KeyType=HASH \
#      --billing-mode PAY_PER_REQUEST
#
# For MinIO:
# ----------
# 1. Start MinIO:
#    docker run -p 9000:9000 -p 9001:9001 minio/minio server /data --console-address ":9001"
#
# 2. Create bucket via MinIO Console or mc:
#    mc alias set local http://localhost:9000 minioadmin minioadmin
#    mc mb local/cognive-terraform-state
#
# 3. Set environment variables:
#    export AWS_ACCESS_KEY_ID=minioadmin
#    export AWS_SECRET_ACCESS_KEY=minioadmin
#    export AWS_S3_ENDPOINT=http://localhost:9000
#
# =============================================================================

